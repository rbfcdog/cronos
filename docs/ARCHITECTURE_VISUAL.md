# x402 Agent Playground - Architecture Diagram

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER / LLM LAYER                                â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Natural    â”‚     â”‚     LLM      â”‚     â”‚  Developer   â”‚          â”‚
â”‚  â”‚   Language   â”‚â”€â”€â”€â”€â–¶â”‚  (GPT-4o)    â”‚â”€â”€â”€â”€â–¶â”‚   Tools      â”‚          â”‚
â”‚  â”‚    Intent    â”‚     â”‚              â”‚     â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                     â”‚                     â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                               â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Tool Call / API Request
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AI AGENTS LAYER                                â”‚
â”‚                      (agents/src/)                                     â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PlannerAgent (planner.agent.ts)                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ OpenAI gpt-4o-2024-08-06                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Zod schemas for structured outputs                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Natural language â†’ ExecutionPlan                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Extract: addresses, amounts, actions                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Fallback: Regex parser (no API key needed)           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚        â”‚                                                         â”‚  â”‚
â”‚  â”‚        â”‚ ExecutionPlan                                           â”‚  â”‚
â”‚  â”‚        â–¼                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  RiskAgent (risk.agent.ts)                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ AI-powered risk assessment                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Risk scores: 0-1 (low/medium/high/critical)          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Recommendations: approve/review/reject                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Fallback: Rule-based evaluation                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                              â”‚
â”‚         â”‚ Playground-compatible ExecutionPlan                         â”‚
â”‚         â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ POST /api/playground/{simulate|execute}
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PLAYGROUND BACKEND                                â”‚
â”‚                  (backend/src/playground/)                             â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  API Routes (routes/playground.ts)                               â”‚ â”‚
â”‚  â”‚  â€¢ POST /simulate    - Virtual execution                         â”‚ â”‚
â”‚  â”‚  â€¢ POST /execute     - Real blockchain                           â”‚ â”‚
â”‚  â”‚  â€¢ POST /validate    - Plan validation                           â”‚ â”‚
â”‚  â”‚  â€¢ GET  /runs/:id    - Retrieve trace                            â”‚ â”‚
â”‚  â”‚  â€¢ GET  /runs        - List all runs                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                                                       â”‚
â”‚                â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Playground Runner (runner.ts)                                   â”‚ â”‚
â”‚  â”‚  â€¢ Orchestrates simulation vs execution                          â”‚ â”‚
â”‚  â”‚  â€¢ Routes actions to appropriate handlers                        â”‚ â”‚
â”‚  â”‚  â€¢ Manages execution lifecycle                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        â”‚                                               â”‚              â”‚
â”‚        â”‚ mode: "simulate"                              â”‚ mode: "execute"
â”‚        â”‚                                               â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Simulation Engine           â”‚              â”‚  Real Execution â”‚   â”‚
â”‚  â”‚  (simulator.ts)              â”‚              â”‚  (runner.ts)    â”‚   â”‚
â”‚  â”‚                              â”‚              â”‚                 â”‚   â”‚
â”‚  â”‚  â€¢ simulateReadBalance()     â”‚              â”‚  â€¢ getBalance() â”‚   â”‚
â”‚  â”‚  â€¢ simulatePayment()         â”‚              â”‚  â€¢ sendTx()     â”‚   â”‚
â”‚  â”‚  â€¢ simulateContractCall()    â”‚              â”‚  â€¢ callContract()â”‚  â”‚
â”‚  â”‚  â€¢ Gas estimation            â”‚              â”‚  â€¢ Real gas     â”‚   â”‚
â”‚  â”‚  â€¢ Virtual balance tracking  â”‚              â”‚  â€¢ Tx hashes    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                               â”‚              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  State Manager (state.ts)                                      â”‚  â”‚
â”‚  â”‚  â€¢ VirtualWallet: balances (TCRO, USDC)                        â”‚  â”‚
â”‚  â”‚  â€¢ Contracts: deployed addresses, status                       â”‚  â”‚
â”‚  â”‚  â€¢ x402: execution history                                     â”‚  â”‚
â”‚  â”‚  â€¢ updateBalance(), deductBalance(), addBalance()              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Trace Builder (trace.ts)                                      â”‚  â”‚
â”‚  â”‚  â€¢ Step-by-step execution recording                            â”‚  â”‚
â”‚  â”‚  â€¢ ActionResult for each step                                  â”‚  â”‚
â”‚  â”‚  â€¢ Warnings and errors tracking                                â”‚  â”‚
â”‚  â”‚  â€¢ Timing and performance metrics                              â”‚  â”‚
â”‚  â”‚  â€¢ Agent-readable trace summaries                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Response: SimulationResult | ExecutionResult
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  {                      â”‚
                â”‚    runId,               â”‚
                â”‚    success: true,       â”‚
                â”‚    trace: {             â”‚
                â”‚      steps: [...],      â”‚
                â”‚      virtualState,      â”‚
                â”‚      warnings: [],      â”‚
                â”‚      errors: []         â”‚
                â”‚    },                   â”‚
                â”‚    summary: {           â”‚
                â”‚      totalGasEstimate   â”‚
                â”‚    }                    â”‚
                â”‚  }                      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ (execute mode only)
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BLOCKCHAIN LAYER                                   â”‚
â”‚                    (Cronos Testnet)                                   â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ExecutionRouter                                                 â”‚â”‚
â”‚  â”‚  0x0B10060fF00CF2913a81f5BdBEA1378eD10092c6                      â”‚â”‚
â”‚  â”‚  â€¢ executePayment() - Routes x402 payments                       â”‚â”‚
â”‚  â”‚  â€¢ Authorization checks                                          â”‚â”‚
â”‚  â”‚  â€¢ Pausable for safety                                           â”‚â”‚
â”‚  â”‚  â€¢ Emits PaymentExecuted events                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  TreasuryVault                                                   â”‚â”‚
â”‚  â”‚  0x169439e816B63D3836e1E4e9C407c7936505C202                      â”‚â”‚
â”‚  â”‚  â€¢ deposit() - Accept CRO deposits                               â”‚â”‚
â”‚  â”‚  â€¢ withdraw() - Owner withdrawals                                â”‚â”‚
â”‚  â”‚  â€¢ Current balance: 2 TCRO                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  AttestationRegistry                                             â”‚â”‚
â”‚  â”‚  0xb183502116bcc1b41Bb42C704F4868e5Dc812Ce2                      â”‚â”‚
â”‚  â”‚  â€¢ recordAttestation() - Record execution proofs                 â”‚â”‚
â”‚  â”‚  â€¢ Trusted attesters configured                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Examples

### Example 1: Simulation Flow

```
1. User: "Send 0.5 CRO to Alice"
   â”‚
   â–¼
2. PlannerAgent
   Input:  "Send 0.5 CRO to Alice"
   Output: {
     executionId: "exec-001",
     type: "payment",
     steps: [{
       action: "payment",
       target: "0x742d35...",
       amount: "0.5"
     }],
     estimatedGas: "21000"
   }
   â”‚
   â–¼
3. RiskAgent
   Input:  ExecutionPlan
   Output: {
     overallRisk: "low",
     riskScore: 0.1,
     recommendation: "approve"
   }
   â”‚
   â–¼
4. Convert to Playground Format
   {
     mode: "simulate",
     actions: [{
       type: "x402_payment",
       to: "0x742d35...",
       amount: "0.5"
     }]
   }
   â”‚
   â–¼
5. POST /api/playground/simulate
   â”‚
   â–¼
6. Simulation Engine
   â€¢ Check balance: 10 TCRO
   â€¢ Deduct: 10 - 0.5 = 9.5 TCRO
   â€¢ Estimate gas: 210000
   â€¢ No real transaction
   â”‚
   â–¼
7. State Manager
   â€¢ Update virtual balance
   â€¢ Record x402 execution (simulated)
   â”‚
   â–¼
8. Trace Builder
   â€¢ Step 1: x402_payment - simulated
   â€¢ Gas: 210000
   â€¢ Balance: 9.5 TCRO
   â”‚
   â–¼
9. Response
   {
     success: true,
     runId: "run_001",
     trace: { /* detailed trace */ },
     summary: {
       totalGasEstimate: "210000",
       successfulSteps: 1
     }
   }
```

### Example 2: Execution Flow

```
1. Same steps 1-4 as simulation
   â”‚
   â–¼
5. POST /api/playground/execute
   â”‚
   â–¼
6. Real Execution
   â€¢ Load real balance from chain
   â€¢ Create transaction
   â€¢ Sign with executor key
   â€¢ Send to Cronos
   â€¢ Wait for confirmation
   â”‚
   â–¼
7. Cronos Blockchain
   â€¢ ExecutionRouter.executePayment()
   â€¢ Transfer 0.5 TCRO
   â€¢ Emit PaymentExecuted event
   â€¢ Mine block
   â”‚
   â–¼
8. Trace Builder
   â€¢ Step 1: x402_payment - success
   â€¢ Tx hash: 0x8b193107...
   â€¢ Gas used: 212340
   â€¢ Explorer: https://explorer.cronos.org/testnet/tx/0x8b19...
   â”‚
   â–¼
9. Response
   {
     success: true,
     runId: "run_002",
     transactions: [{
       hash: "0x8b193107...",
       explorerUrl: "https://..."
     }],
     summary: {
       totalGasUsed: "212340"
     }
   }
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SECURITY BOUNDARIES                       â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   LLM / Agent   â”‚         â”‚    Backend      â”‚     â”‚
â”‚  â”‚                 â”‚         â”‚                 â”‚     â”‚
â”‚  â”‚  âŒ No keys     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  âœ… Has keys    â”‚     â”‚
â”‚  â”‚  âŒ No signing  â”‚  Plans  â”‚  âœ… Signs txs   â”‚     â”‚
â”‚  â”‚  âœ… Reasoning   â”‚         â”‚  âœ… Sends txs   â”‚     â”‚
â”‚  â”‚  âœ… Planning    â”‚         â”‚  âœ… Auth checks â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                       â”‚               â”‚
â”‚                                       â”‚ Authorized    â”‚
â”‚                                       â”‚ Transactions  â”‚
â”‚                                       â”‚               â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                              â”‚   Blockchain    â”‚      â”‚
â”‚                              â”‚                 â”‚      â”‚
â”‚                              â”‚  âœ… Validates   â”‚      â”‚
â”‚                              â”‚  âœ… Executes    â”‚      â”‚
â”‚                              â”‚  âœ… Records     â”‚      â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Advantages

### 1. Separation of Concerns
- **Agents**: Think and plan (no keys)
- **Backend**: Execute (secured keys)
- **Blockchain**: Validate and record

### 2. Observability at Every Layer
- **Agent Layer**: Plans, risk scores
- **Playground**: Traces, states
- **Blockchain**: Events, txs

### 3. Safety First
- **Simulation**: Test before real execution
- **Validation**: Check plans before running
- **Risk Assessment**: AI evaluates every plan

### 4. Developer Friendly
- **REST APIs**: Standard HTTP/JSON
- **TypeScript**: Full type safety
- **Documentation**: Comprehensive guides

---

**This architecture enables safe, observable, and debuggable AI-blockchain interactions.** ğŸ¯
